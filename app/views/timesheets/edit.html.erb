<div id="swap_from">
  <div id="screen_body" class="container">
    <% form_for([@contractor, @timesheet], :html => {:name => 'ts_form'}) do |f| %>
      <div class="Left">
        <div class="col">
          <div class="page_header">
            <h1 class="index">
              <%= two_column_nav_bar_layout2("Client: #{@contract.client.name}, Contract: #{@contract.ref}", link_to(image_tag('/images/printer_48.gif', :class => 'small_icon', :title => 'Print'), edit_contractor_user_timesheet_path(@contractor, @timesheet) + ".pdf", :class => 'image')) %>
            </h1>
          </div>
          <div class="innercol">
            <div style="display: none;" id="error_msgs">
            </div>
            <div style="display: none;" id="notice">
            </div>
            <%= show_errors('Unable to save timesheet', f.error_messages) %>
            <%= show_notice(flash[:notice]) %>

            <% html_header = (@timesheet.status == 'DRAFT' || @timesheet.status == 'DENIED') ? 'Edit Timesheet' : 'New Timesheet' %>
            <% html_header_right = '' %>
            <% if @timesheet.status == "DRAFT" || @timesheet.status == 'DENIED' %>
              <% html_header_right << submit_tag("Submit", :title => @submit_button_title, :class => @submit_button_class, :disabled => @disable_submit) %>
              <% html_header_right << "&nbsp;#{submit_tag('Submit as Manual', :title => 'Submit for manual approval', :class => 'generalButton')}&nbsp;#{submit_tag('Save as draft', :class => 'generalButton')}" %>
            <% elsif @timesheet.status == "SUBMITTED" || @timesheet.status == "MANUAL" %>
              <% html_header_right << "#{submit_tag("Cancel", :title => "Cancel Timesheet", :class => 'generalButton', :onclick => "Modalbox.show(\"cancel_timesheet_alert\", {title: (this.title == '' ? 'Confirm' : this.title), width: 300, autoFocusing: false}); return false;")}" %>
            <% end %>

            <% html_header_right << "&nbsp;<input type=\"button\" class=\"generalButton\" value=\"Close\" onclick=\"nav('#{currenttimesheets_path(:date_period => Navigator.get_position(session, :contractor_timesheets)[0], :timesheet_status => Navigator.get_position(session, :contractor_timesheets)[1], :page => Navigator.get_position(session, :contractor_timesheets)[3])}');\" />" %>
            <div id="blue-box">
              <div class="padder" id="padder">          


                <%=render :partial=>"/timesheet_entry" ,:locals=>{:f=>f}%>



              </div>
            </div>
          </div>
        </div>
        <div class="bottom"><%=left_panel_footer%></div>
      </div>
      <div class="Right">
        <div class="col sidebar">
          <div class="new_task_wrapper">
            <%= right_panel_bar_with_header(html_header, html_header_right) %>

            <%notes_content=''%>
            <%notes_content << "<table width=\"95%\" cellpadding=\"2\" cellspacing=\"0\">" %>
            <% if @timesheet.status != 'DRAFT' %>
              <% notes_content << "<tr valign=\"top\"><td><span class=\"bold\">#{@timesheet.userName} - #{@timesheet.updated_at.to_formatted_s(:uk_date_time_24)}</span><br />#{@timesheet.note}</td></tr>"%>
            <%end%>
            <% for note in @notes %>
              <% cls = cycle("odd_row_dull", "") -%>
              <%notes_content << "<tr class='#{cls}' valign='\top\'>"%>
              <%notes_content << "<td><span class=\"bold\">#{note.userName} - #{note.updated_at.to_formatted_s(:uk_date_time_24)}</span><br />#{note.note}</td></tr>"%>
            <%end%>
            <% if @notes.length == 0 &&  @timesheet.status == 'DRAFT' %>
              <%notes_content << "<tr><td colspan=\"2\">&nbsp;</td></tr><tr><td colspan=\"2\" align=\"center\"><i>No notes to display</i></td></tr>" %>
            <%end%>
            <%notes_content << "</table>"%>
            <%= right_panel_bar_with_header("Notes",notes_content) %>

            <%new_notes_content=''%>
            <%new_notes_content << ''%>
            <%new_notes_content << ''%>
            <%new_notes_content << ''%>
            <%= right_panel_bar_with_header("Add New Note (only saved when submitted)",text_area_tag('notes', nil, :rows => 7, :style => "width: 97%", :onKeyDown => 'limitText(this,255)', :onKeyUp => 'limitText(this,255)', :disabled => @timesheet.status == 'APPROVED') ) %>
          </div>
        </div>
      </div>
    <% end %>
  </div>

  <div style="clear: both"></div>
</div>


<script type="text/javascript">

  var navbarbox = RUZEE.ShadedBorder.create({corner:8, border:1});
  navbarbox.render('nav-bar-box');
  var bluebox = RUZEE.ShadedBorder.create({corner:8, border:1});
  bluebox.render('blue-box');
  var type_box = RUZEE.ShadedBorder.create({corner:8, border:1});
  type_box.render('left-header-box');
  var bluebox1 = RUZEE.ShadedBorder.create({corner:8, border:1});
  bluebox1.render('blue-box1');
  var bluebox2 = RUZEE.ShadedBorder.create({corner:8, border:1});
  bluebox2.render('blue-box2');
  CalcAll('<%= @timesheet.timesheet_entries.length%>');

</script>
